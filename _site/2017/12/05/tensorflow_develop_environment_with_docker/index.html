<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <div class="container"> <div class="col s10"> <div class="row" style="padding:10px;"> <a class="waves-effect waves-light btn white-text darken-2 grey z-depth-4" href="/#blog"><i class="material-icons">arrow_back</i></a> </div> <h3 class="post-title" itemprop="name headline" style="text-align:center">使用Docker搭建Tensorflow开发环境</h3> <p class="post-meta"> <time datetime="2017-12-05T05:15:05+08:00" itemprop="datePublished"> Dec 5, 2017 </time> </p> <div class="post-content" itemprop="articleBody"> <p>本文基于Ubuntu 16.04 LTS使用Docker来搭建Tensorflow的开发环境.</p> <p>Docker和Tensorflow就不用介绍了,项目均已开源在Github.</p> <ul> <li><a href="https://github.com/tensorflow/tensorflow">Tensorflow</a></li> <li><a href="https://github.com/docker/docker-ce">Docker CE</a></li> </ul> <h2 id="docker的安装">Docker的安装</h2> <p>Docker的安装在官方网站有非常详细的文档,请参考:<a href="https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/">Docker CE installation on Ubuntu</a><br> 本文只是做一个稍微简单一点的概述.</p> <h3 id="step-1-卸载旧版本">Step 1 卸载旧版本</h3> <p>使用如下命令:</p> <blockquote> <blockquote> <p><strong>sudo apt remove docker docker-engine docker.io</strong></p> </blockquote> </blockquote> <h3 id="step-2-安装docker-ce">Step 2 安装Docker CE</h3> <p>依次使用如下命令:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update  
<span class="nb">sudo </span>apt install <span class="se">\ </span> 
    apt-transport-https <span class="se">\ </span> 
    ca-certificates <span class="se">\ </span> 
    software-properties-common  
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>apt-key add -  
<span class="c"># 验证指纹  </span>
<span class="nb">sudo </span>apt-key fingerprint 0EBFCD88  
<span class="c"># X86_64/amd64平台    </span>
<span class="nb">sudo </span>add-apt-repository <span class="se">\ </span> 
   <span class="s2">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="se">\ </span><span class="s2"> 
   </span><span class="k">$(</span>lsb_release <span class="nt">-cs</span><span class="k">)</span><span class="s2"> </span><span class="se">\ </span><span class="s2"> 
   stable"</span>  
<span class="c"># 安装Docker CE  </span>
<span class="nb">sudo </span>apt update  
<span class="nb">sudo </span>apt install docker-ce  
</code></pre></div></div> <p>至此,Docker CE已经通过apt源安装在机器上了.</p> <h2 id="tensorflow的安装">Tensorflow的安装</h2> <p>接下来可以安装Tensorflow了.</p> <p>本教程使用的是Tensorflow GPU版本,因此需要在Docker Hub拉取Tensorflow-gpu的镜像即可.<br> 如果安装CPU版本的Tensorflow,会更简单.</p> <h3 id="安装nvidia显卡驱动和cuda-toolkit">安装NVIDIA显卡驱动和CUDA toolkit</h3> <p>目前Tensorflow GPU版本支持需要CUDA 8.0和cuDNN 6.0, 直接从官网下载安装好即可.<br> 驱动直接安装最新的即可.<br> CUDA 8.0的下载入口不明显,在NVIDIA下载页面的底部,有一个 <strong>Legacy Releases</strong> 链接,点进去既可看到各种历史版本的CUDA.<br> cuDNN安装6.0版本即可.<br> 安装好之后要配置环境变量.</p> <h3 id="安装nvidia-docker">安装NVIDIA-Docker</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker volume <span class="nb">ls</span> <span class="nt">-q</span> <span class="nt">-f</span> <span class="nv">driver</span><span class="o">=</span>nvidia-docker | xargs <span class="nt">-r</span> <span class="nt">-I</span><span class="o">{}</span> <span class="nt">-n1</span> docker ps <span class="nt">-q</span> <span class="nt">-a</span> <span class="nt">-f</span> <span class="nv">volume</span><span class="o">={}</span> | xargs <span class="nt">-r</span> docker rm <span class="nt">-f</span>
<span class="nb">sudo </span>apt-get purge nvidia-docker
<span class="nb">sudo </span>apt-get install nvidia-docker2
<span class="nb">sudo </span>pkill <span class="nt">-SIGHUP</span> dockerd  
</code></pre></div></div> <h3 id="拉取并运行tensorflow-gpu镜像">拉取并运行Tensorflow-GPU镜像</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvidia-docker run <span class="nt">-it</span> <span class="nt">-p</span> 8888:8888 tensorflow/tensorflow:latest-gpu  
</code></pre></div></div> <p>本地没有 tensorflow/tensorflow:latest-gpu镜像,Docker会自动从Docker Hub拉取.<br> 等它结束之后,本地已经有了最新版本的GPU版的Tensorflow.<br> 上述命令会进入一个新的容器,里面装好了tensorflow-gpu版本,可以直接使用了.</p> </div> </div> </div> </body></html>